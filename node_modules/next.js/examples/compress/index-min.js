module.exports=require("./lib/next.js");var fs=require("fs"),path=require("path"),uglify=require("uglify-js"),next=require("../../index.js"),fileName=process.argv[2],filePath=path.dirname(fileName),outputFileName="index-min.js",rscript=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,run=next.pipe(function(a,b){a?b(null,a):b("调用的时候请输入文件名，例如:node compress.js code.html")},function(a,b){fs.readFile(a,"utf-8",b)},function(a,b){var c=[];a.match(rscript).forEach(function(a){var b=a.indexOf('src="');b!==-1&&(a=a.substring(b+5),a=a.substring(0,a.indexOf('"')),a!==outputFileName&&c.push(a))}),b(null,c)},next.map(function(a,b){var c=path.resolve(filePath,a);console.log("read file from: "+c),fs.readFile(c,"utf-8",b)}),function(a,b){console.log("compressing content..."),b(null,uglify(a.join("")))},function(a,b){var c=path.resolve(path.join(filePath,outputFileName));console.log("write file to: "+c),fs.writeFile(c,a,"utf-8",b)});run(fileName,function(a){a?console.log(a):console.log("compress file complete")})